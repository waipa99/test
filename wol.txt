===========================================================================
【ソ フ ト名】　wol
【バージョン】　1.93
【 著作権者 】　M.Ogawa
【 対応機種 】　Windows95/98/SE/ME/XP/NT/2000
【 主な機能 】　LANからパソコンを起動させる
【ソフト種別】　フリーソフトウェア
【最新版配布】　http://www.geocities.co.jp/SiliconValley-Bay/8891/
===========================================================================

wolをダウンロードいただき、ありがとうございます。


１．動作環境
　　一般的な32bit Windows環境で動作可能です。開発＆テスト環境にはWindows2000を
　使っています。この他の環境で実際にテストしていないので動かない場合も考えられ
　ます。その場合、知らせていただけると幸いです。
　2000Serverでも動作確認済みです。
　XP-Home, NT-Workstation, NT-Serverが未確認です。

　※開発＆テスト環境は、ver1.5あたりから、XP-Proに切り替えました
  最近では、手間がかかるので、2000-ProとXP-Proでしか動作確認してません。
　ですから問題があれば知らせてください。さもなければ永遠に気づかないので。

２．wolの概要
　　本ソフトはWindows上で動作する、MagicPacketを送信することで、LAN上の
　パソコンを起動させる（Wake On Lan）ソフトです。私の場合、本ソフトで起動さ
　せ、VNC（起動マシンのスタートアップに登録しておく）やAstecX等で操作＆終了
　させています。
　インストールは不要です。常駐もしないので使うときのみ、起動してください。
　　クイックランチャー等に入れておくと良いと思います。
　　MACアドレスを設定しておくと、ダブルクリックでターゲットマシンを起動させられ
　ます。起動リストはメモリの限り登録できます。当方はせいぜい数台ですけど。
　　LAN内のWindowsNT/2000/XPのマシンを、リモートでシャットダウン・再起動させる
　ことができます（右クリックメニュー）。

３．使用方法
　　ダウンロードした wol.lzh の内容をすべて任意のフォルダに解凍後、
　wol.exeを実行するだけです。SendMsgNT.dllは消去可能です。ただし、
  メッセージ送信が出来なくなります。
　　通常必要とされるのは、起動させられる側のMACアドレスのみです。

コマンドラインからの使用法(改訂版)

ex.1) wol /open=wol.ini /wake=1 foo hoge voke
wol.iniリスト中のfoo hoge vokeというマシンを起動命令を1回送信します。
ex.2) wol -open=wol.ini -wake=1 foo hoge voke
/の代わりに-を使ってもまったく同じです。
ex.3) wol -wake=1 foo hoge voke
wol.iniが標準で開かれるので省略できます。
ex.4) wol -wake foo hoge voke
ついでにwakeのパラメータデフォルトが1なので省略されます。
ex.5) wol -wake foo hoge -4 voke
こうするとvokeだけ起き難い場合など4回起こします。
このようなことが出来るのは数値パラメータのみで、
openやnoticeのように文字列パラメータを要求する場合は無理です。

では応用です。
ex.6) wol -wake=8 foo -notice=落します hoge -wake voke
こうするとfooを8回起こし、hogeに「落します」と告知し、
vokeを8回起こします(前回のがデフォルトとして残っている；これが言いたかった)。

ex.7) wol -wake *
こうする事ですべてのマシンを起動できます。
この仕様のため、*というマシンを登録するとコマンドラインから個別指定できません。

注意）
左から順にデコードします。
マシン名の小文字大文字の違いに注意してください。
=の前後にスペースを入れないで下さい。
悪い例)-open = wol.ini   -open =wol.ini   -open= wol.iniなど
良い例)-open=wol.ini

動作	コマンド	数値の解釈（省略時）
Lst読込 open		wol.ini

電源ON	wake		送信回数(1)

Normal	windown		猶予時間[s](30)
(推奨)	winreset	猶予時間[s](30)
	wincancel	意味なし
	
Extend	windown2	意味なし
	winreset2	意味なし
	winlogoff	意味なし
	
telnet	teldown		猶予時間[s](30)	//使用不可；パスの取得法を考え中
	telreset	猶予時間[s](30)	//使用不可；パスの取得法を考え中
	telcancel	意味なし	//使用不可；パスの取得法を考え中
	
	mnotice		メッセージ候補番号1〜
	notice		メッセージ文字列（「-notice=本文」のみ可で、
			「-本文」は不可です。省略時空文）

予告)
*だけじゃなく?等も使えるようにしたいと思う。
ファイル指定にも導入予定。


４．MACアドレスについて
  [Windows系]
　DOS窓から
　ipconfig /all
　とすれば表示されます。
　DOS窓が見つからない場合、スタート＞ファイル名を指定して実行＞command.com
　ipconfig /all | more
　とかやればOKです。
　スタート＞ファイル名を指定して実行＞winipcfg.exe
　でも非NT系なら、取得可だと思います。

  [UNIX系]
  % arp -a
　や
  % arp -e
　で表示させます。

５．起動マシンの設定
　　当たり前な話ですが、そもそも、起動マシンがWOLに対応している必要があります。
  1)ATX電源でかつ+5VSB（待機電流）に余裕があること
　2)マザーボードが対応していること（WOL用のコネクタかPCIからの起動に対応してい
　　ること。後者はLANカードの仕様によっては、pingのみで起きてしまう可能性あり）
　3)LANカードの対応
  4)BIOS設定（パワーマネージメントとかWake-up eventに関するところをよく見る）
 　
６．トラブルシューティング
　　WOLケーブルがモデム用のコネクタに挿さってないか、MACアドレスがあっているか
　よく確認してください。ドライバの更新も有効な場合があります。win2k/XP等では、
　LANカードのドライバのプロパティを開き、詳細設定や電源の管理をいじってみるのも
　有効かも知れません。ハマるときはハマるものだと思うので気長に。無論このプログ
　ラムのバグによる事もありうるので、怒らずメールください(汗)。

７．各種オマケ機能について
７a．リモートシャットダウン/リモート再起動機能（推奨）
　●WindowsNT/2000/Xp限定
　●送信側のログイン名とパスワードが、相手先に同じように管理者で登録されている
　●ユーザが管理者権限を持っている
　●マイネットワークで見えるマシン名が項目として登録されている

　　この機能は、便利ではあるが危険でもあるため、オマケとして右クリックメニュー
　でのみ使用できます。
　　重ねて言いますが、ダウンロード中であろうが、CD焼き中であろうが、シャットダ
　ウンできてしまうのです。ゆえに、操作するPCの状態を把握できないかぎり、
　この機能の使用は控えたほうが良いでしょう。

　※Windows2000のシャットダウン系のトラブルはCD-RW関係のドライバ（パケット・ラ
　　イティング/リーダー）を外すとうまく行く場合があります。
　※雷鳥+A7V(KT133)+蟹LAN+SB-Platinum+RADION-VEで、試しに何回かクリーンインス
　　トールしてみました。電源落とせます画面がでたり、普通に電源落とせたり、よく
　　分からないです。電源落とせます画面で止まる方が多い気も。度重なるクリーンイ
　　ンストール作業は堪えるので解明を投げました。A7Vに振り回されている気もしな
　　くもないしねぇ。

７b．リモートシャットダウン/リモート再起動機能（Extend）
　●WindowsNTSP4以上(多分)/2000/Xp限定
　●送信側のログイン名とパスワードが、相手先に同じように管理者で登録されている
　●ユーザが管理者権限を持っている
　●マイネットワークで見えるマシン名が項目として登録されている

　　この機能は、便利ではあるが危険でもあるため、十分注意して使ってください。
　ダウンロード中であろうが、CD焼き中であろうが、落とせてしまいます。ゆえに、
　操作するPCの状態を把握できない限り、この機能の使用は控えた方が良いでしょう。

　※上の方法で、Windows2000の一部の電源切断が出来ない場合にこちらを使って
　ください。

７c．telnet版リモートシャットダウン/リモート再起動機能
　　telnet版です。Linuxのシャットダウン用にどうぞ。ターゲットマシンでのデーモン
　起動の方法は説明いたしません。まだ人柱機能です。カスタマイズできないと困る人
　がいれば対応します。どういう風に記述するか非常に厄介かも。猶予時間についても
　いろいろ考えるとこがあります。

　※通常キャンセルは使えません。now指定で間に合わないから（笑）。

　　動き的には以下のように振舞っています。
  {ログイン名：katsuo，パスワード：sazae，パスワード：namihei}の例
　login: katsuo
　Password: sazae
　$ su
　Password: namihei
　# shutdown -h now       ;-h:シャットダウン -r:リブート -c:キャンセル
　# exit
　$ exit

７d．鋭意保留中：ssh版リモートシャットダウン/リモート再起動機能
　　sshはサクっと対応できそうにないので保留としました。

７e．連携機能
　　VNC/XPリモートデスクトップ/Telnet/Ftpの連携機能を入れてみる。そのうち、
　カスタマイズ可能な形に持ってゆきたいなと。入れて欲しいものがあればどうぞ。
　ftp/telnetはOS標準のものなので、実用性薄いかも。telnetエンジン内部に持ってる
　のに使わないのなんでだろって自分でも思ってます。

８．アンインストール方法
　　　関連するファイルを全て削除するだけです。

９．配布・転載について
　　　本ソフトウエアはフリーウエアですので配布・転載は自由に行っていただいて構
　　いません。
　　　但し、２次配布・転載の際には以下の事項を厳守してください。
　　１）このアーカイブファイルに含まれる全てのファイルを改竄なしに同梱する。
　　　　（アーカイブの形式を変えるのは可）
　　２）有料ネットでない限り、他のサイトへの転載は問題ありませんが、その際に
　　　　は連絡先まで御一報ください。（事後報告でも構いません。）
　　３）上記以外に転載する場合や出版物等の一部として配布する際には、事前に当方
　　　　に連絡して許可を得てからにしてください。ただし、個人的に友人等に配布す
　　　　る場合はこの限りではありません。
　　４）本ソフトウエアの売買は行わないでください。

10．著作権について
　　　本ソフトウェアに関する著作権は、作者のM.Ogawaが保持します。
　　　作者の承諾無しでのソフトウェアの解析、逆アセンブル、逆コンパイルなどは、
　　特に禁止しません（笑）。

11．連絡先
　　　バグや感想、助言、転載、動作報告(救われます)は下記までお願いします。

　　　　E-Mail : m__ogawa@hotmail.com
（アンダースコア'_'は2つです。まあ打ち直す人はいないと思うけど念のため）
あえて列挙してませんが、いろいろな人の意見を取り入れさせて頂いております。
ありがとうございます。
http://www.geocities.co.jp/SiliconValley-Bay/8891/
にて実験サイトを開設しましたので、よろしくお願いします。

12．免責事項
　　　本ソフトを使用したことによる、如何なる損害も、当方は一切の責任を負いませ
　　んので、予めご了承の上、本ソフトウェアをご使用ください。


＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
Ver1.0　　2002/ 5/15　　一般公開
Ver1.1　　2002/ 8/ 5　　MACアドレス取り込み機能の追加＆ツールチップ追加
Ver1.2　　2002/10/ 3　　v.1.1で混入した、致命的なバグの修正
　　　　　　　　　　　　MFC必要・不要版の両方のバンドル
Ver1.3　　2002/11/28　　コマンドラインオプションに対応
			タスクスケジューラやtelnetと連動して使えるように（多分）Ver1.4　　2003/ 2/ 3　　WindowsNT/2000/XPのリモートシャットダウン機能追加
			右クリックメニューの動作改善、アイコンの微妙な手直し
			バージョン情報にURL表示
Ver1.5　　2003/ 4/13　　wol.iniの省略を許す（コマンドライン系のバグが出るかも）
			リモートシャットダウン機能(Extend)追加
			Telnetからのリモートシャットダウン機能追加
			オマケの配置変更と整理
			オマケ第２弾：連携機能付加
			DNSによるアドレス解決機能追加
Ver1.6　　2003/ 9/12　　VNCのパスの修正(自分でいじってたのを忘れてた〜汗)
			ping/通知機能追加
			コマンドライン拡張(モード指定追加につき必ずチェック)
			メインUI若干スマート化
			複数選択可能に
			ヘルプとしてwol.txtを開けるようにした
			DLL不要版に一本化（初心者を戸惑わすだけだったので）
			portの読み出し部分の修正
Ver1.7　　2003/10/31　　GUI改良、NTメッセージ機能の強化
			Auto設定でIPとMASKも自動設定
Ver1.8　　2003/11/16　　PING機能追加、Telnetでのshutdownのpathの指定可能に
			OS判別処理追加（9x系で使えなくなっていた部分を訂正）
Ver1.9　　2003/12/ 2　　RealVNCを優先して起動するようにした。XPのリモートデス
			クトップ機能はクライアントをインストールできるらしいこ
			とを知り、XPチェックを廃しました。
			スイッチを廃し、ドロップダウンメニューに統合
Ver1.91 　2004/ 1/11　　ルータを経由で起動を追加
                        アプリ連携での名前解決のバグ修正
                        複数のMACアドレスを持つ端末でのバグ修正
Ver1.92 　2004/ 4/ 7　　アプリ連携の共有リソースを使用のバグ修正--tantanさん
Ver1.93 　2004/ 6/ 6　　アプリ連携をユーザ定義可能にした

Ver1.92より指摘者を掲載することにしました。それまでにも多くの人の助けにより
成り立っています。この場で感謝の意を示したいと思います。
結構多いのですが、本名でのメールの場合、個人情報保護の観点から
問題となり得るため、掲示板経由のみ対象とします。
また、本名でいいよという方は連絡してください。


■補足
○サブネットマスクはブロードキャストアドレスを計算するために設定が必要です。
自動設定ではIPアドレスにより、以下のように決定します。
クラスA：  0.0.0.0〜127.255.255.255 ＞ 255.  0.  0.  0
クラスB：128.0.0.0〜191.255.255.255 ＞ 255.255.  0.  0
クラスC：192.0.0.0〜233.255.255.255 ＞ 255.255.255.  0
クラスD：234.0.0.0〜255.255.255.255 ＞ 255.255.255.255
環境によって違うと思うので、各自修正してください。

○学校から家など、ピンポイント発信の際は、IPはグローバルアドレス、
MASKは255.255.255.255と設定してください。
Auto設定ではLAN内部のIPが割り振られてしまいます。ご注意ください。

○良くわからない場合は、IP:0.0.0.0 MASK:0.0.0.0と設定しても大丈夫です。
ただし、同一セグメント上（同じルータの配下）に存在するPC間でのみ可能です。

○IPが変化する環境では、レコード名に相当するIPを調べてから、発信します。
IP:255.255.255.255 MASK:255.255.255.255
現段階ではMASKを設定できないのでピンポイント発信にのみ有効です。
しかし、最終的にMACアドレスで起動するわけですから、
LAN内をうまくルーティング＆ブロードキャストことで解決できるでしょう。

○リモートシャットダウン/リモート再起動機能が使えない場合
操作先のマシンの「コントロールパネル」を開く
「管理ツール」を開く
「ローカルセキュリティポリシー」を開く
ローカル ポリシー＞セキュリティー オプション
「ネットワーク アクセス：ローカル アカウントの共有とセキュリティ モデル」をダブルクリック
「クラシック- ローカルユーザがローカルユーザとして認証する」を選択

○メッセージを受信できない場合
操作先のマシンの「コントロールパネル」を開く
「管理ツール」を開く
「サービス」を開く
「Messenger」を「自動」または「開始」にする

それでも出来ない場合、port139が使用可能か確認する。

■アプリ連携をwol.defで定義できます。
とりあえず使える特殊コマンドだけ列挙します。
デフォルトの記述を見てみれば分かると思います。
<コマンド・オプションに記述可能>
%desktop% デスクトップ
%startprogram% プログラム
%MyDocuments% マイ ドキュメント
%Favorites% お気に入り
%startup% スタートアップ
%Recent% 最近使ったファイル
%SendTo% SendTo
%Trash% ごみ箱
%startmenu% スタートメニュー
%My Music% マイ ミュージック
%desktopdirectory% デスクトップ上のファイルオブジェクトを格納するフォルダ
%NetHood% NetHood
%Fonts% フォントを含む仮想フォルダ
%Templates% ドキュメントテンプレートが格納されるフォルダ
%CommonStartMenu% AllUsers の スタートメニュー
%CommonStartProgram% AllUsers の プログラム
%CommonStartup% AllUsers の スタートアップ
%CommonDesktop% AllUsers の デスクトップ
%ApplicationData% Application Data
%PrintHood%「プリンタ」仮想フォルダにおかれるリンクオブジェクトを格納するフォルダ
%LocalSettings_Application Data% Application Data
%AltStartup% 非ローカル版のスタートアップ
%CommonAltStartup% 非ローカル版の AllUsers の スタートアップ
%Common_Favorites% AllUsers のお気に入り（NT系のみ）
%TemporaryInternetFiles% インターネット一時ファイルを格納するフォルダ
%Cookies% Cookies
%History% 履歴
%Common_Application Data% AllUsers の Application Data
%SystemRoot% Windows ディレクトリ 
%SystemDirectory% Windows Systemディレクトリ
%ProgramFiles% Program Filesフォルダ
%MyPictures% My Picturesフォルダ
%homepath% profile フォルダ
%userprofile% profile フォルダ
%CommonFiles%Windows Program Files\Common (2k/XP)
%CommonTemplates% AllUsers のドキュメントテンプレートが格納されるディレクトリ（NT系)
%CommonDocuments% AllUsersのドキュメントテンプレートが格納されるディレクトリ（NT系 or Shfolder.dll)
%CommonAdmintool% AllUsersの管理ツールディレクトリ
%Admintool% 管理ツールディレクトリ

<オプションで指定可能>
%debug%		最終的に実行するコマンドを表示する
%localhost%	ローカルホスト名
%record%	レコード名
%ip%		IPアドレス ex.)192.168.1.12
%broadcast%	ブロードキャストアドレス ex.)192.168.1.255
%mask%		マスクアドレス
%port%		ポート番号
%mac-%		MACアドレス ex.)02-af-00-22-80-80
%mac:%		MACアドレス ex.)02:af:00:22:80:80
%mac%		MACアドレス ex.)02af00228080

■今後の課題
最小化時のタスクバー化(多分不要)
ネットワーク上で発見できた端末の登録機能
リモートデスクトップ機能のプロファイル情報管理(過去に要望あり再検討中)
アプリごとのポート番号の指定
パスワードの管理（暗号化して保存）
簡単にタイマ予約（タスク登録）するためのウィザード
ちゃんとしたヘルプを付ける(汗

